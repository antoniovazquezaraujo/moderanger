<div class="commands-container">
    <div *ngFor="let command of block.commands" class="command">
        <select class="command-type" [(ngModel)]="command.type">
            <option *ngFor="let type of commandTypeNames" [value]="type">{{type}}</option>
        </select>

        <ng-container [ngSwitch]="command.type">
            <select *ngSwitchCase="commandTypes.PLAYMODE" [(ngModel)]="command.value">
                <option *ngFor="let mode of playModeNames" [value]="mode">{{mode}}</option>
            </select>

            <select *ngSwitchCase="commandTypes.SCALE" [(ngModel)]="command.value">
                <option *ngFor="let scale of scaleNames" [value]="scale">{{scale}}</option>
            </select>

            <ng-container *ngSwitchDefault>
                <ng-container *ngIf="command.isVariable; else numberInput">
                    <p-dropdown class="command-value" 
                        [options]="availableVariables" 
                        [ngModel]="getSelectedValue(command)"
                        (ngModelChange)="handleValueInput($event, command)" 
                        [showClear]="true"
                        optionLabel="label"
                        optionValue="value"
                        [placeholder]="availableVariables.length ? 'Select variable' : 'No variables'"
                        appendTo="body">
                    </p-dropdown>
                </ng-container>
                <ng-template #numberInput>
                    <input class="command-value" type="number" [ngModel]="command.value"
                        (ngModelChange)="handleValueInput($event, command)">
                </ng-template>
            </ng-container>
        </ng-container>

        <button class="variable-toggle" [class.active]="command.isVariable" (click)="toggleVariableMode(command, $event)">
            $
        </button>

        <button class="remove-command" (click)="removeCommand(command)">Ã—</button>
    </div>
</div>

<button class="remove-command" (click)="addCommand()">+</button>