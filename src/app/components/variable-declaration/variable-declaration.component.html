<div class="variables-container">
    <form (submit)="addVariable($event)" class="variable-form" #varForm="ngForm">
        <input type="text" [(ngModel)]="newVariable.name" name="name" placeholder="Variable name" required>
        
        <select [(ngModel)]="newVariable.type" name="type" required>
            <option value="number">Number</option>
            <option value="playmode">Play Mode</option>
            <option value="melody">Melody</option>
            <option value="scale">Scale</option>
        </select>

        <ng-container [ngSwitch]="newVariable.type">
            <select *ngSwitchCase="'playmode'" [(ngModel)]="newVariable.value" name="value" required>
                <option *ngFor="let mode of playModeNames" [value]="mode">{{mode}}</option>
            </select>

            <select *ngSwitchCase="'scale'" [(ngModel)]="newVariable.value" name="value" required>
                <option *ngFor="let scale of scaleNames" [value]="scale">{{scale}}</option>
            </select>

            <input *ngSwitchCase="'number'" 
                type="number" 
                class="number-input"
                style="width:45px !important; max-width:45px !important;"
                [(ngModel)]="newVariable.value"
                name="value"
                [min]="-999"
                [max]="999"
                step="1">

            <ng-container *ngSwitchCase="'melody'">
                <input 
                    type="text" 
                    [(ngModel)]="newVariable.value" 
                    name="value"
                    placeholder="Enter notes (e.g. 1 2 3)"
                    pattern="^[\s\d]+$"
                    [ngModelOptions]="{updateOn: 'blur'}"
                    required>
                <div *ngIf="varForm.form.get('value')?.invalid && 
                        varForm.form.get('value')?.touched" 
                        class="validation-error">
                    Melody must contain only digits and spaces
                </div>
            </ng-container>
        </ng-container>

        <p-button type="submit" 
            [disabled]="!newVariable.name || !varForm.form.valid"
            icon="pi pi-plus">
        </p-button>
    </form>

    <div class="variables-list">
        <div *ngFor="let variable of variables; let i = index" class="variable-item">
            <span class="variable-name">{{variable.name}}</span>
            
            <ng-container [ngSwitch]="variable.type">
                <select *ngSwitchCase="'playmode'" 
                    [(ngModel)]="variable.value" 
                    (ngModelChange)="updateVariable(i)">
                    <option *ngFor="let mode of playModeNames" [value]="mode">{{mode}}</option>
                </select>

                <select *ngSwitchCase="'scale'" 
                    [(ngModel)]="variable.value" 
                    (ngModelChange)="updateVariable(i)">
                    <option *ngFor="let scale of scaleNames" [value]="scale">{{scale}}</option>
                </select>

                <input *ngSwitchCase="'number'" 
                    type="number" 
                    class="number-input"
                    style="width:45px !important; max-width:45px !important;"
                    [(ngModel)]="variable.value"
                    (ngModelChange)="updateVariable(i)"
                    [min]="-999"
                    [max]="999"
                    step="1">

                <input *ngSwitchCase="'melody'" 
                    type="text" 
                    [(ngModel)]="variable.value" 
                    (blur)="updateVariable(i)"
                    pattern="^[\s\d]+$"
                    placeholder="Enter notes (e.g. 1 2 3)">
            </ng-container>

            <p-button (click)="removeVariable(i)" 
                icon="pi pi-times">
            </p-button>
        </div>
    </div>
</div> 